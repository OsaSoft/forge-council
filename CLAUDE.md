# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

> `CLAUDE.md` and `AGENTS.md` are autogenerated by `/Init`. Do not edit directly -- run `/Update` to regenerate.

## What This Is

forge-council is a pure-markdown multi-agent orchestration framework. Thirteen specialist agents run structured 3-round debates (Initial Positions, Challenges, Convergence) organized into four council types plus standalone use. No compiled code -- only markdown agent definitions, YAML configuration, and shell scripts.

## Install / Verify

```bash
make install          # deploy agents + skills (Claude, Gemini, Codex)
make verify           # check agents deployed + skills present
make verify-skills    # verify skills across all runtimes
make clean            # remove previously installed agents
make lint             # shellcheck all scripts
```

Standalone agent deployment without Make:

```bash
lib/bin/install-agents agents              # install all agents
lib/bin/install-agents agents --dry-run    # preview
lib/bin/install-agents agents --clean      # clean + reinstall
```

No automated tests or CI. Verification is manual per `VERIFY.md` plus `make verify`.

## Architecture

```
agents/           13 specialist markdown files (frontmatter + structured body)
skills/           5 skill dirs: DebateCouncil, Demo, DeveloperCouncil, KnowledgeCouncil, ProductCouncil
lib/              git submodule -> forge-lib (Rust binaries for deployment + validation)
defaults.yaml     canonical agent roster + council compositions
config.yaml       user overrides (gitignored), same structure as defaults
module.yaml       module metadata (name, version)
.claude-plugin/   plugin.json manifest for Claude Code plugin discovery
.claude/          generated by `make install` (gitignored, .gitkeep only)
.gemini/          generated by `make install` (gitignored, .gitkeep only)
.codex/           generated by `make install` (gitignored, .gitkeep only)
.opencode/        generated by `make install` (gitignored, .gitkeep only)
```

Platform directories (`.claude/`, `.gemini/`, `.codex/`) contain deployed agents and skills generated by `make install`. They are gitignored -- never edit directly. Source of truth is `agents/`, `skills/`, and `defaults.yaml`.

### How Councils Work

Skills define the orchestration. The main session IS the moderator (never spawn a separate moderator). Flow: gate check (agent teams flag) -> parse input -> select roster (max 7) -> spawn team (TeamCreate + parallel Task) -> 3 rounds -> synthesize verdict + teardown (TeamDelete). If agent teams are unavailable, falls back to sequential subagent calls.

Parallel council execution requires `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1` in `~/.claude/settings.json` env. Without it, same debate runs sequentially.

@AgentTeams.md

### Agent Files (`agents/*.md`)

YAML frontmatter with required keys: `name` (PascalCase, matches filename), `description` (pattern: `"Role -- capabilities. USE WHEN triggers."`), `version`.

Deployment config (model, tools, scope) lives in `defaults.yaml`, not in agent frontmatter. Agent files contain only identity (name, description, version) and body instructions.

Body structure in order: blockquote summary (ends with "Shipped with forge-council."), `## Role`, `## Expertise`, `## Personality` (optional), `## Instructions`, `## Output Format`, `## Constraints`.

Constraints must include the honesty clause ("If X is solid, say so") and team communication clause ("communicate findings to the team lead via SendMessage when done"). Every critique must include a concrete suggestion.

### Tool Assignments

| Tools | Agents |
|-------|--------|
| Read, Grep, Glob | SystemArchitect, UxDesigner, DocumentationWriter |
| Read, Grep, Glob, WebSearch | TheOpponent |
| Read, Grep, Glob, Bash | DatabaseEngineer, DevOpsEngineer, SecurityArchitect, ForensicAgent |
| Read, Grep, Glob, Bash, Write, Edit, WebSearch | SoftwareDeveloper, QaTester |
| Read, Grep, Glob, WebSearch, WebFetch | WebResearcher, ProductManager, DataAnalyst |

Model tiers (`fast`/`strong`) and tool assignments live in `defaults.yaml`. Override per-agent with `config.yaml`.

### Skill Files (`skills/*/SKILL.md` + `SKILL.yaml`)

`SKILL.md` contains orchestration instructions. `SKILL.yaml` contains metadata and provider routing (`claude`, `gemini`, `codex`). Skills follow numbered steps (Step 1-7). Debate modes detected from user keywords: checkpoint (default), autonomous ("fast"), interactive ("step by step"), quick ("quick check").

### Configuration

- `defaults.yaml`: canonical roster -- edit only when adding/removing agents
- `config.yaml`: user overrides (gitignored) -- same structure, only changed fields
- `module.yaml`: module metadata -- update `version` on releases

### forge-lib Submodule (`lib/`)

Git submodule from `forge-lib`. Provides Rust binaries: `install-agents` (multi-provider agent deployment), `install-skills` (provider-aware skill installer), `strip-front` (frontmatter stripping), `validate-module` (convention test suite). Built via `make -C lib build`. If missing: `git submodule update --init`.

## Conventions

### Naming

| Context | Convention |
|---------|-----------|
| Agent filenames / name | PascalCase (`SecurityArchitect.md`) |
| Skill directories | PascalCase (`DeveloperCouncil/`) |
| Shell functions | lowercase_snake_case |
| Shell constants | UPPER_SNAKE_CASE |
| YAML keys | lowercase |
| Team names (runtime) | lowercase-kebab (`dev-council`) |

### Shell Scripts

Shebang `#!/usr/bin/env bash`, start with `set -euo pipefail`. Resolve paths with `SCRIPT_DIR="$(builtin cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"`. Source libraries, don't execute. Functions use `local` variables and don't exit (let caller decide). Prefer `FORGE_LIB` env var from forge-core, fall back to local `lib/`.

### Markdown Style

Em-dashes (`--`) in prose. `claude.description` uses pattern: `"Role -- capabilities. USE WHEN triggers."`. No trailing whitespace. Files end with newline.

### Git

Conventional Commits: `type: description`. Lowercase, no trailing period, no scope. Types: `feat`, `fix`, `docs`.

## Modification Workflows

**Add agent**: Create `agents/Name.md` with frontmatter + structured body -> add to `defaults.yaml` roster -> `lib/bin/install-agents agents --dry-run` -> commit `feat: add Name for [domain]`.

**Modify skill**: Edit `skills/Name/SKILL.md` + `SKILL.yaml` -> keep step numbering intact -> if changing roster, update both skill and `defaults.yaml` -> test with `/Demo`.

**Update model/tools**: Edit `defaults.yaml` (or `config.yaml` override) -> `lib/bin/install-agents agents --clean` -> restart session.
